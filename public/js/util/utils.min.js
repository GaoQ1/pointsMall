var http=function(n){var e={host:"",errHandler:function(n){console.log(n)},loginHandler:function(){bridgeUserInfo.isKdlsAppBridge?bridgeCheckAppLogin():window.location="/login"}};if(n)for(var o in n)e[o]=n[o];var r=function(n,e,o){a(n,e,"GET",o)},t=function(n,e,o){a(n,e,"POST",o)},a=function(n,o,r,t){$.ajax({url:e.host+n,dataType:"json",data:o,type:r,success:function(n){"202"==n.status.code?e.loginHandler&&e.loginHandler():"1"==n.status.code?t&&t(n.result):e.errHandler(n.status.desp)},error:function(n){e.errHandler(n)}})};return{get:r,post:t}},utility=function(){var n=function(n,e){if(e){for(var o in e)n[o]=e[o];return n}};return{extend:n}}(),login=function(){var n=function(n){var e={verifyContainer:"#verifyPhone",btnDisableClass:"bgGray",btnLabel:"获取验证码",phoneVerifyUrl:"/getsmscode?json=1",imageVerifyUrl:"/imgcode?json=1",showImgCaptcha:!0,imageCaptchaUrl:"",loginUrl:"login?json=1",phoneErrHandler:function(){alert("手机号格式错误")},onCaptchError:function(){},onCaptchSuccess:function(){},onClearCaptchInfo:function(){},loginSuccessHandler:function(){alert("登录成功")}};utility.extend(e,n);var o,r,t,a,i,l,c,s,d,h;h=$(e.verifyContainer+" .loginBtn"),o=$(e.verifyContainer+" .phone"),r=$(e.verifyContainer+" .phoneCodeContainer"),t=$(e.verifyContainer+" .phoneCodeText"),a=$(e.verifyContainer+" .getPhoneCodeBtn");var f=http(),p=0,u=function(){p++,c&&c.val(""),l.attr("src",e.imageCaptchaUrl+"?phone="+o.val()+"&num="+p)};e.showImgCaptcha?(i=$(e.verifyContainer+" .imageCodeContainer"),l=$(e.verifyContainer+" .imageCode"),c=$(e.verifyContainer+" .imageCodeText"),r.hide(),o.val().match(/^1[3|4|5|6|7|8|9]\d{9}$/)?(s=o.val(),i.show(),l.attr("src",""),u()):i.hide(),l.on("click",function(){l.attr("src",""),u()}),c.on("input propertychange",function(){d!=c.val()&&(d=c.val()),d.length>4?e.onCaptchError():4==d.length?f.post(e.imageVerifyUrl,{imgCode:d,phone:s},function(n){"0000"==n.code?(e.onCaptchSuccess(),i.hide(),r.show(),a.html(e.btnLabel).removeClass(e.btnDisableClass).prop("disabled",!1),t.val("")):e.onCaptchError()}):e.onClearCaptchInfo()})):(i=$(e.verifyContainer+" .imageCodeContainer"),i&&i.hide()),o.on("input propertychange",function(){s!=o.val()&&(s=o.val(),t.val(""),e.showImgCaptcha&&(c.val(""),r.hide(),s.match(/^1[3|4|5|6|7|8|9]\d{9}$/)?(i.show(),l.attr("src",""),u()):i.hide()))}),a.on("click",function(){o.val().match(/^1[3|4|5|6|7|8|9]\d{9}$/)?(a.addClass(e.btnDisableClass),f.post(e.phoneVerifyUrl,{type:1,phone:o.val()},function(n){var o=60;a.html(o+" 秒").prop("disabled",!0);var r=setInterval(function(){o>1?(o-=1,a.html(o+" 秒")):(clearInterval(r),a.html(e.btnLabel).removeClass(e.btnDisableClass).prop("disabled",!1))},1e3)})):e.phoneErrHandler()}),h.on("click",function(){f.post(e.loginUrl,{verifyCode:t.val(),userName:o.val(),loginType:"1"},function(n){e.loginSuccessHandler()})})};return{loginHandler:n}}();